<?xml version="1.0" encoding="UTF-8"?>
<transformation>
  <info>
    <name>Daily Sales</name>
    <description />
    <extended_description />
    <trans_version />
    <trans_type>Normal</trans_type>
    <directory>/</directory>
    <parameters>
    </parameters>
    <log>
      <trans-log-table>
        <connection />
        <schema />
        <table />
        <size_limit_lines />
        <interval />
        <timeout_days />
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STATUS</id>
          <enabled>Y</enabled>
          <name>STATUS</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
          <subject />
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
          <subject />
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
          <subject />
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
          <subject />
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
          <subject />
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
          <subject />
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>STARTDATE</id>
          <enabled>Y</enabled>
          <name>STARTDATE</name>
        </field>
        <field>
          <id>ENDDATE</id>
          <enabled>Y</enabled>
          <name>ENDDATE</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>DEPDATE</id>
          <enabled>Y</enabled>
          <name>DEPDATE</name>
        </field>
        <field>
          <id>REPLAYDATE</id>
          <enabled>Y</enabled>
          <name>REPLAYDATE</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>Y</enabled>
          <name>LOG_FIELD</name>
        </field>
        <field>
          <id>EXECUTING_SERVER</id>
          <enabled>N</enabled>
          <name>EXECUTING_SERVER</name>
        </field>
        <field>
          <id>EXECUTING_USER</id>
          <enabled>N</enabled>
          <name>EXECUTING_USER</name>
        </field>
        <field>
          <id>CLIENT</id>
          <enabled>N</enabled>
          <name>CLIENT</name>
        </field>
      </trans-log-table>
      <perf-log-table>
        <connection />
        <schema />
        <table />
        <interval />
        <timeout_days />
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>SEQ_NR</id>
          <enabled>Y</enabled>
          <name>SEQ_NR</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>INPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>INPUT_BUFFER_ROWS</name>
        </field>
        <field>
          <id>OUTPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>OUTPUT_BUFFER_ROWS</name>
        </field>
      </perf-log-table>
      <channel-log-table>
        <connection />
        <schema />
        <table />
        <timeout_days />
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>LOGGING_OBJECT_TYPE</id>
          <enabled>Y</enabled>
          <name>LOGGING_OBJECT_TYPE</name>
        </field>
        <field>
          <id>OBJECT_NAME</id>
          <enabled>Y</enabled>
          <name>OBJECT_NAME</name>
        </field>
        <field>
          <id>OBJECT_COPY</id>
          <enabled>Y</enabled>
          <name>OBJECT_COPY</name>
        </field>
        <field>
          <id>REPOSITORY_DIRECTORY</id>
          <enabled>Y</enabled>
          <name>REPOSITORY_DIRECTORY</name>
        </field>
        <field>
          <id>FILENAME</id>
          <enabled>Y</enabled>
          <name>FILENAME</name>
        </field>
        <field>
          <id>OBJECT_ID</id>
          <enabled>Y</enabled>
          <name>OBJECT_ID</name>
        </field>
        <field>
          <id>OBJECT_REVISION</id>
          <enabled>Y</enabled>
          <name>OBJECT_REVISION</name>
        </field>
        <field>
          <id>PARENT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>PARENT_CHANNEL_ID</name>
        </field>
        <field>
          <id>ROOT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>ROOT_CHANNEL_ID</name>
        </field>
      </channel-log-table>
      <step-log-table>
        <connection />
        <schema />
        <table />
        <timeout_days />
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>N</enabled>
          <name>LOG_FIELD</name>
        </field>
      </step-log-table>
      <metrics-log-table>
        <connection />
        <schema />
        <table />
        <timeout_days />
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>METRICS_DATE</id>
          <enabled>Y</enabled>
          <name>METRICS_DATE</name>
        </field>
        <field>
          <id>METRICS_CODE</id>
          <enabled>Y</enabled>
          <name>METRICS_CODE</name>
        </field>
        <field>
          <id>METRICS_DESCRIPTION</id>
          <enabled>Y</enabled>
          <name>METRICS_DESCRIPTION</name>
        </field>
        <field>
          <id>METRICS_SUBJECT</id>
          <enabled>Y</enabled>
          <name>METRICS_SUBJECT</name>
        </field>
        <field>
          <id>METRICS_TYPE</id>
          <enabled>Y</enabled>
          <name>METRICS_TYPE</name>
        </field>
        <field>
          <id>METRICS_VALUE</id>
          <enabled>Y</enabled>
          <name>METRICS_VALUE</name>
        </field>
      </metrics-log-table>
    </log>
    <maxdate>
      <connection />
      <table />
      <field />
      <offset>0.0</offset>
      <maxdiff>0.0</maxdiff>
    </maxdate>
    <size_rowset>10000</size_rowset>
    <sleep_time_empty>50</sleep_time_empty>
    <sleep_time_full>50</sleep_time_full>
    <unique_connections>N</unique_connections>
    <feedback_shown>Y</feedback_shown>
    <feedback_size>50000</feedback_size>
    <using_thread_priorities>Y</using_thread_priorities>
    <shared_objects_file />
    <capture_step_performance>N</capture_step_performance>
    <step_performance_capturing_delay>1000</step_performance_capturing_delay>
    <step_performance_capturing_size_limit>100</step_performance_capturing_size_limit>
    <dependencies>
    </dependencies>
    <partitionschemas>
    </partitionschemas>
    <slaveservers>
    </slaveservers>
    <clusterschemas>
    </clusterschemas>
    <created_user>-</created_user>
    <created_date>2018/08/03 16:28:52.032</created_date>
    <modified_user>-</modified_user>
    <modified_date>2018/08/03 16:28:52.032</modified_date>
    <key_for_session_key>H4sIAAAAAAAAAAMAAAAAAAAAAAA=</key_for_session_key>
    <is_key_private>N</is_key_private>
  </info>
  <notepads>
  </notepads>
  <connection>
    <name>Linx</name>
    <server>${LINX_HOST}</server>
    <type>MSSQLNATIVE</type>
    <access>Native</access>
    <database>${LINX_DATABASE}</database>
    <port>1433</port>
    <username>${LINX_USERNAME}</username>
    <password>${LINX_PASSWORD}</password>
    <servername />
    <data_tablespace />
    <index_tablespace />
    <attributes>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_LOWERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_UPPERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>IS_CLUSTERED</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>MSSQLUseIntegratedSecurity</code>
        <attribute>false</attribute>
      </attribute>
      <attribute>
        <code>MSSQL_DOUBLE_DECIMAL_SEPARATOR</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>PORT_NUMBER</code>
        <attribute>1433</attribute>
      </attribute>
      <attribute>
        <code>PRESERVE_RESERVED_WORD_CASE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>QUOTE_ALL_FIELDS</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_BOOLEAN_DATA_TYPE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_TIMESTAMP_DATA_TYPE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>USE_POOLING</code>
        <attribute>N</attribute>
      </attribute>
    </attributes>
  </connection>
  <order>
    <hop>
      <from>Daily Sales</from>
      <to>Daily Sales Output</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Stock</from>
      <to>Stock Output</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Stock Without Store</from>
      <to>Stock Output WO Store</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Receivings</from>
      <to>Receivings Output</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Receivings Without Store</from>
      <to>Receivings Output WO Store</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Daily Sales Week</from>
      <to>Daily Sales Week Output</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Daily Sales Sellers</from>
      <to>Daily Sales Sellers Output</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Daily Sales Sellers WEEK</from>
      <to>Daily Sales Sellers Output 2</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Daily Sales Orders</from>
      <to>Daily Sales Orders Output</to>
      <enabled>Y</enabled>
    </hop>
  </order>
  <step>
    <name>Daily Sales</name>
    <type>TableInput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>Linx</connection>
    <sql>SELECT
p.colecao,
--'' as colecao,
COALESCE(ccc.categoria,cct.categoria,ccs.categoria,cc.categoria,'Outros') as categoria,
LTRIM(RTRIM(COALESCE(NULLIF(f.filial,'E-COMMERCE'),'CAMBUI'))) as filial,
CASE
	WHEN CONVERT(NVARCHAR(6), vp.data_venda, 112) = CONVERT(NVARCHAR(6), GETDATE()-1, 112) THEN 'MTD'
	WHEN CONVERT(NVARCHAR(6), vp.data_venda, 112) = CONVERT(NVARCHAR(6), DATEADD(m,-1,GETDATE()-1), 112) THEN 'LM'
	WHEN CONVERT(NVARCHAR(6), vp.data_venda, 112) = CONVERT(NVARCHAR(6), DATEADD(yy,-1,GETDATE()-1), 112) THEN 'LY'
END as periodo,
CASE WHEN CONVERT(NVARCHAR(6), vp.data_venda, 112) = CONVERT(NVARCHAR(6), GETDATE()-1, 112) THEN CONVERT(NVARCHAR,vp.data_venda,103) ELSE '' END as data_venda,
SUM(vp.qtde) as itens,
CAST(SUM(vp.qtde*(vp.preco_liquido + vp.desconto_item)) as INT) as preco_original_total,
CAST(SUM(vp.qtde*(v.valor_pago/v.valor_venda_bruta*vp.preco_liquido)) as INT) as receita_total,
CAST(SUM(c.preco1*vp.qtde) as INT) as custo_total
FROM loja_venda_produto vp
INNER JOIN loja_venda v on
	v.ticket = vp.ticket and
	vp.codigo_filial = v.codigo_filial and
	v.data_venda = vp.data_venda
INNER JOIN filiais f on f.cod_filial = vp.codigo_filial
INNER JOIN produtos p on p.produto = vp.produto
INNER JOIN produtos_precos c on
	p.produto = c.produto and
	c.codigo_tab_preco = 02 -- 02 custo
LEFT JOIN bi_categorizacao_categoria ccc on
	ccc.grupo_produto = p.grupo_produto and
	ccc.cod_categoria = p.cod_categoria and
	ccc.subgrupo_produto is null and
	ccc.tipo_produto is null
LEFT JOIN bi_categorizacao_categoria cct on
	cct.grupo_produto = p.grupo_produto and
	cct.tipo_produto = p.tipo_produto and
	cct.subgrupo_produto is null and
	cct.cod_categoria is null
LEFT JOIN bi_categorizacao_categoria ccs on
	ccs.grupo_produto = p.grupo_produto and
	ccs.subgrupo_produto = p.subgrupo_produto and
	ccs.tipo_produto is null and
	ccs.cod_categoria is null
LEFT JOIN bi_categorizacao_categoria cc on
	cc.grupo_produto = p.grupo_produto and
	cc.subgrupo_produto is null and
	cc.tipo_produto is null and
	cc.cod_categoria is null
WHERE
p.grupo_produto != 'GIFTCARD' and
vp.qtde > 0 and
vp.preco_liquido > 0 and
DAY(vp.data_venda) &lt;= DAY(GETDATE()-1) and CONVERT(NVARCHAR(6), vp.data_venda, 112) IN (
	CONVERT(NVARCHAR(6), GETDATE()-1, 112), -- Mes Atual
	CONVERT(NVARCHAR(6), DATEADD(m,-1,GETDATE()-1), 112), -- Mes Passado
	CONVERT(NVARCHAR(6), DATEADD(yy,-1,GETDATE()-1), 112) -- Ano Passado
)
GROUP BY
p.colecao,
COALESCE(ccc.categoria,cct.categoria,ccs.categoria,cc.categoria,'Outros'),
LTRIM(RTRIM(COALESCE(NULLIF(f.filial,'E-COMMERCE'),'CAMBUI'))),
CASE
	WHEN CONVERT(NVARCHAR(6), vp.data_venda, 112) = CONVERT(NVARCHAR(6), GETDATE()-1, 112) THEN 'MTD'
	WHEN CONVERT(NVARCHAR(6), vp.data_venda, 112) = CONVERT(NVARCHAR(6), DATEADD(m,-1,GETDATE()-1), 112) THEN 'LM'
	WHEN CONVERT(NVARCHAR(6), vp.data_venda, 112) = CONVERT(NVARCHAR(6), DATEADD(yy,-1,GETDATE()-1), 112) THEN 'LY'
END,
CASE WHEN CONVERT(NVARCHAR(6), vp.data_venda, 112) = CONVERT(NVARCHAR(6), GETDATE()-1, 112) THEN CONVERT(NVARCHAR,vp.data_venda,103) ELSE '' END


UNION

SELECT
p.colecao,
--'' as colecao,
COALESCE(ccc.categoria,cct.categoria,ccs.categoria,cc.categoria,'Outros') as categoria,
'E-COMMERCE' as filial,
CASE
	WHEN CONVERT(NVARCHAR(6), f.emissao, 112) = CONVERT(NVARCHAR(6), GETDATE()-1, 112) THEN 'MTD'
	WHEN CONVERT(NVARCHAR(6), f.emissao, 112) = CONVERT(NVARCHAR(6), DATEADD(m,-1,GETDATE()-1), 112) THEN 'LM'
	WHEN CONVERT(NVARCHAR(6), f.emissao, 112) = CONVERT(NVARCHAR(6), DATEADD(yy,-1,GETDATE()-1), 112) THEN 'LY'
END as periodo,
CASE WHEN CONVERT(NVARCHAR(6), f.emissao, 112) = CONVERT(NVARCHAR(6), GETDATE()-1, 112) THEN CONVERT(NVARCHAR,f.emissao,103) ELSE '' END as data_venda,
SUM(fp.qtde) as itens,
CAST(SUM(fp.valor + fp.desconto_item) as INT) as preco_original_total,
CAST(SUM(f.valor_total/f.valor_sub_itens*fp.valor) as INT) as receita_total,
CAST(SUM(c.preco1*fp.qtde) as INT) as custo_total
FROM faturamento_prod fp
INNER JOIN faturamento f on
	f.nf_saida = fp.NF_SAIDA and
	fp.filial = f.filial
INNER JOIN produtos p on p.produto = fp.produto
INNER JOIN produtos_precos c on
	p.produto = c.produto and
	c.codigo_tab_preco = 02 -- 02 custo
LEFT JOIN bi_categorizacao_categoria ccc on
	ccc.grupo_produto = p.grupo_produto and
	ccc.cod_categoria = p.cod_categoria and
	ccc.subgrupo_produto is null and
	ccc.tipo_produto is null
LEFT JOIN bi_categorizacao_categoria cct on
	cct.grupo_produto = p.grupo_produto and
	cct.tipo_produto = p.tipo_produto and
	cct.subgrupo_produto is null and
	cct.cod_categoria is null
LEFT JOIN bi_categorizacao_categoria ccs on
	ccs.grupo_produto = p.grupo_produto and
	ccs.subgrupo_produto = p.subgrupo_produto and
	ccs.tipo_produto is null and
	ccs.cod_categoria is null
LEFT JOIN bi_categorizacao_categoria cc on
	cc.grupo_produto = p.grupo_produto and
	cc.subgrupo_produto is null and
	cc.tipo_produto is null and
	cc.cod_categoria is null
WHERE
p.grupo_produto != 'GIFTCARD' and
fp.qtde > 0 and
f.valor_sub_itens > 0 and
fp.serie_nf IN (2,7) and
f.natureza_saida = '100.01' and
f.filial = 'e-commerce' and
DAY(f.emissao) &lt;= DAY(GETDATE()-1) and CONVERT(NVARCHAR(6), f.emissao, 112) IN (
	CONVERT(NVARCHAR(6), GETDATE()-1, 112), -- Mes Atual
	CONVERT(NVARCHAR(6), DATEADD(m,-1,GETDATE()-1), 112), -- Mes Passado
	CONVERT(NVARCHAR(6), DATEADD(yy,-1,GETDATE()-1), 112) -- Ano Passado
)
GROUP BY
p.colecao,
COALESCE(ccc.categoria,cct.categoria,ccs.categoria,cc.categoria,'Outros'),
CASE
	WHEN CONVERT(NVARCHAR(6), f.emissao, 112) = CONVERT(NVARCHAR(6), GETDATE()-1, 112) THEN 'MTD'
	WHEN CONVERT(NVARCHAR(6), f.emissao, 112) = CONVERT(NVARCHAR(6), DATEADD(m,-1,GETDATE()-1), 112) THEN 'LM'
	WHEN CONVERT(NVARCHAR(6), f.emissao, 112) = CONVERT(NVARCHAR(6), DATEADD(yy,-1,GETDATE()-1), 112) THEN 'LY'
END,
CASE WHEN CONVERT(NVARCHAR(6), f.emissao, 112) = CONVERT(NVARCHAR(6), GETDATE()-1, 112) THEN CONVERT(NVARCHAR,f.emissao,103) ELSE '' END</sql>
    <limit>0</limit>
    <lookup />
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>96</xloc>
      <yloc>176</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Daily Sales Orders</name>
    <type>TableInput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>Linx</connection>
    <sql>SELECT
LTRIM(RTRIM(COALESCE(NULLIF(f.filial,'E-COMMERCE'),'CAMBUI'))) as filial,
CASE
	WHEN CONVERT(NVARCHAR(6), vp.data_venda, 112) = CONVERT(NVARCHAR(6), GETDATE()-1, 112) THEN 'MTD'
	WHEN CONVERT(NVARCHAR(6), vp.data_venda, 112) = CONVERT(NVARCHAR(6), DATEADD(m,-1,GETDATE()-1), 112) THEN 'LM'
	WHEN CONVERT(NVARCHAR(6), vp.data_venda, 112) = CONVERT(NVARCHAR(6), DATEADD(yy,-1,GETDATE()-1), 112) THEN 'LY'
END as periodo,
COUNT(DISTINCT CAST(v.data_venda as varchar) + v.codigo_filial + v.ticket) as orders
FROM loja_venda_produto vp
INNER JOIN loja_venda v on
	v.ticket = vp.ticket and
	vp.codigo_filial = v.codigo_filial and
	v.data_venda = vp.data_venda
INNER JOIN filiais f on f.cod_filial = vp.codigo_filial
INNER JOIN produtos p on p.produto = vp.produto
WHERE
p.grupo_produto != 'GIFTCARD' and
vp.qtde > 0 and
vp.preco_liquido > 0 and
DAY(vp.data_venda) &lt;= DAY(GETDATE()-1) and CONVERT(NVARCHAR(6), vp.data_venda, 112) IN (
	CONVERT(NVARCHAR(6), GETDATE()-1, 112), -- Mes Atual
	CONVERT(NVARCHAR(6), DATEADD(m,-1,GETDATE()-1), 112), -- Mes Passado
	CONVERT(NVARCHAR(6), DATEADD(yy,-1,GETDATE()-1), 112) -- Ano Passado
)
GROUP BY
LTRIM(RTRIM(COALESCE(NULLIF(f.filial,'E-COMMERCE'),'CAMBUI'))),
CASE
	WHEN CONVERT(NVARCHAR(6), vp.data_venda, 112) = CONVERT(NVARCHAR(6), GETDATE()-1, 112) THEN 'MTD'
	WHEN CONVERT(NVARCHAR(6), vp.data_venda, 112) = CONVERT(NVARCHAR(6), DATEADD(m,-1,GETDATE()-1), 112) THEN 'LM'
	WHEN CONVERT(NVARCHAR(6), vp.data_venda, 112) = CONVERT(NVARCHAR(6), DATEADD(yy,-1,GETDATE()-1), 112) THEN 'LY'
END

UNION

SELECT
'E-COMMERCE' as filial,
CASE
	WHEN CONVERT(NVARCHAR(6), f.emissao, 112) = CONVERT(NVARCHAR(6), GETDATE()-1, 112) THEN 'MTD'
	WHEN CONVERT(NVARCHAR(6), f.emissao, 112) = CONVERT(NVARCHAR(6), DATEADD(m,-1,GETDATE()-1), 112) THEN 'LM'
	WHEN CONVERT(NVARCHAR(6), f.emissao, 112) = CONVERT(NVARCHAR(6), DATEADD(yy,-1,GETDATE()-1), 112) THEN 'LY'
END as periodo,
COUNT(DISTINCT f.nf_saida) as orders
FROM faturamento_prod fp
INNER JOIN faturamento f on
	f.nf_saida = fp.NF_SAIDA and
	fp.filial = f.filial
INNER JOIN produtos p on p.produto = fp.produto
WHERE
p.grupo_produto != 'GIFTCARD' and
fp.qtde > 0 and
f.valor_sub_itens > 0 and
fp.serie_nf IN (2,7) and
f.natureza_saida = '100.01' and
f.filial = 'e-commerce' and
DAY(f.emissao) &lt;= DAY(GETDATE()-1) and CONVERT(NVARCHAR(6), f.emissao, 112) IN (
	CONVERT(NVARCHAR(6), GETDATE()-1, 112), -- Mes Atual
	CONVERT(NVARCHAR(6), DATEADD(m,-1,GETDATE()-1), 112), -- Mes Passado
	CONVERT(NVARCHAR(6), DATEADD(yy,-1,GETDATE()-1), 112) -- Ano Passado
)
GROUP BY
CASE
	WHEN CONVERT(NVARCHAR(6), f.emissao, 112) = CONVERT(NVARCHAR(6), GETDATE()-1, 112) THEN 'MTD'
	WHEN CONVERT(NVARCHAR(6), f.emissao, 112) = CONVERT(NVARCHAR(6), DATEADD(m,-1,GETDATE()-1), 112) THEN 'LM'
	WHEN CONVERT(NVARCHAR(6), f.emissao, 112) = CONVERT(NVARCHAR(6), DATEADD(yy,-1,GETDATE()-1), 112) THEN 'LY'
END</sql>
    <limit>0</limit>
    <lookup />
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>720</xloc>
      <yloc>16</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Daily Sales Orders Output</name>
    <type>GoogleSpreadsheetOutput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <serviceEmail>spreadsheets@marcia-mello.iam.gserviceaccount.com</serviceEmail>
    <spreadsheetKey>17S5r8m700DAiTUKwXELXIjFqDhFGAIEw5zSccXXDBKY</spreadsheetKey>
    <worksheetId>ogwxmkd</worksheetId>
    <privateKeyStore>MIIJqwIBAzCCCWQGCSqGSIb3DQEHAaCCCVUEgglRMIIJTTCCBXEGCSqGSIb3DQEHAaCCBWIEggVeMIIFWjCCBVYGCyqGSIb3DQEMCgECoIIE+zCCBPcwKQYKKoZIhvcNAQwBAzAbBBTm0HVktWITkNfGXhQ6ZFhRTb1IeAIDAMNQBIIEyDmDLkUNm9tKEqm7hj+i7lq+CEmKdYndA/OCaSyEtJ0HoBqs1JX3nqurFm9Xp7aHI75s7ZPCdx5oc31ny2zsZmp9LZxK+Bw/bPw4+O8L6fPyMifbSWHy7qhfwt7C+qEvTJIARfVSFE8L7jitL7ihVjhhdvH6JDTpgwVitH2/RmyOu/Eia8bTfxi9dEZaR2JlYKglTF8d74LS5OZgqjAEKPW7qsHZOq952ScFxsVP+BZwtaB4gQ6npeX/lzGlHPpR93QxUTxgUCVZzTmiDq0tCqHwHCCgolJZnTMdKTPIdey8wq/dQ2QAl7r/RIGioQ2PODjfY3hVEgS+Tb9i4l2ANGUvRs1ApA2E+A7yaQciNuK68i2XAcydfwsv3WWPezJV1MkuSe8CYxCyUsFn4XFtthzb6W7+xuFHnxtoMTjWSJMfBx8Xsw+kHD4TBKLlXHuiStmbjna8gvpIYHN12sHqEIrFmkuODZvO5zpDny4SnZcxTruotuoc8CDaz/PCowD04H54td1hjmEMaJJ/2Zt1gOEeOiw0SV1k3CvMZ7uVQdjBtnimosc1NX+wvnqD/FMJNDKQSzKvzOn/wjTmchwNjam437LTwKe7nQQqM++24lxvRPzoAQWC6Zo/VSif4ZBwaRMPexAd9S2pi2HWKQP1c9vyflqY3IGuY5Ll5WyQp8L/hQpfRR7tDHoNyZJUv4GBUxOCOIZ3Zwz014X6oZtUM5Ohu1w3rikjEIZ8len28LyyrSgRZFn77Zn99x54nTm9hCzn8MlQ2nzoFl5FexXbYmasnmMVxMm4lBHNEOHzefxxQoo/K9NT28GHU//WYJRq2uOznf5rstPX6pVTq4/yIct2lYulN4c4yBtXb1MkhGcQ3M6aPVFAAQr9cQov0wNwhWwhugWW0wsoyr9kS5NUqlMcasrjhnXCizI1shrGClJvQ8gm60zMjqx5qea+G4pAnSJIxx+MEdY7daRe2xsYjP8F8fq3K70DQC5TeipbsVTU6HAFrH7Q6hhPwxWPuzLMkTNmElbTsGIH5uylDXMt3ZNWnKBIZaBwpcqPJv/toDTS5rkl29LAPIJfamSvXAhJtbdcayCtu+QSJ4aKvENLJUvsXQn1H/4SZt4PLfEeKF/PSuw4Xaf1/wT7YZuvFglSVJpjRRNZJvuBCWdFnUlwpxTp2sWnEAX6+LLe06SwUWXm8+Uje4bXIhm4fY77pHlPFIVVVDg8QLb5n095vyrehojTHXIbwGxixwePhgBVSd9+jpi3ydXXJInbdOsGKZko9TQMrt8b/fbM3ACAxweVzKXMu6LJzsfBMxs4uZUytuwhQZ+jjdfyWepT/k/QOtoQATJLqREtY0Sw1Eph5leMVDtlxaGGle9iAKa5rAblnsNujZsTh4kbAthj7l3t5WLKoUuERnM9rU3zMy3bJQOP+ePV0kjheDEwlsVPJZTQ1duoddTWnRSwaUAZEmPzcZoGIkxDHfAgMvYTaPrzbZ9p5cn54mNvJrydEPtHOl9Y4dUsmgxk1k3BohM3i0pm4itEG4bxMgiTmgZax13zNIzRfIjulmdgKqnN5DUq/d6tdzJy3Y1kLstzzoDJf/MK/yg5q5M4Z7toCEok6rJMOiMaRFXiQMT4wblgLzFIMCMGCSqGSIb3DQEJFDEWHhQAcAByAGkAdgBhAHQAZQBrAGUAeTAhBgkqhkiG9w0BCRUxFAQSVGltZSAxNTMzMzIxMzg0Mzk2MIID1AYJKoZIhvcNAQcGoIIDxTCCA8ECAQAwggO6BgkqhkiG9w0BBwEwKQYKKoZIhvcNAQwBBjAbBBSqNkneUbNYGesuYVx4mcx+mirIjQIDAMNQgIIDgFIiF734fwzdWGYN8qwvfLBV8InQWy0u1Q4kTvGbaoGL2PLwBpdX/HPzN/VJoWk4iUoIPtTQFfHI7X4umi5h/3nWSux6mdSh0WaOJH2btWSAvNdbMaJwqCpkN7ERhuHyovxdt0MyM21/gldjLv9OWgzls4DwArtQzudaJWUxPhLObkSCm2Dp3X7qlM8YrerHShWz9ccC4syox49MTeZU7y3hf44QnGCYYcl7UGCKQCwmC2CbIP8AtAo9yVUJiVpinISQk6LcqDA0/LTmZ5uasNEC3004fVaWUgXT6+ogDUKjj2d7nxFxIOCswJ+/NfGgcT2x92ZcqKZwsQTSBPicHuGlSAhsp0Wz4CeXwjXVBLyEW6PiZeOKzB6DrxTJtfdbYtNv2RTSkDbL3p84bM68UUIjlC3efNkPdR6raK8IfYkTprFFsmQPcJeRronnSfoGr/5aNowFYL8ImtEo16sGVmkKckMLI4R86pdJT/Zte4veOtkRi8mIl4BwTENjwJAIKomvTLQHrgzAaVTrwIPyIdpvlx1JZuzvVP/PdQV1Oy7Nq3Y0u6LaAEa9SffDj8GIgXO3BDG0dBU1Oar1aB/b37e8dN0ES86CgNOlrQJBIxTjUFQ02fwWHpdA7rI40djjh8vU+eQNRhcnGcTGM1j6MvcUcLxeqhgBEjZImq6Olnz2rmbmNqQmQoVfilBrdYrgjs7duz/R+7MTIMgV9hjVgv+sRp4wSjIouFjf7J1vMhQTz5BJ+fUJ3SdEgaUrTFt/wZ+czNJjSMTBEXuBE8k/JkmaFu3B1W2p6qBsBHfGEm6TuXHz1hKueFgSpzONujHZ8jQFPqMtmY0Z2G1b5IPUFr9HySHUBiKl+b5ulNamxmjqi1ZhCvutHfn1D1BN9NshXlnsQGyjB6rJY+9gvYs/47enfqVQYrU9NzPFdwSRYNriDhroOLhSTx+WlU3U1trnafUdrE9089awdg8y/9GmyIz8pqaU+XsKnTF9A0QZ4QdCVSQxSFfK/iDgV8y1Ndhdi7BASUvdEUggePjBIgmR0vwLbrdpMJAhTg6VGb+Ls/o07tcG5+0hEwx0VcvkeaDulQGbtGHOdh40SWzX9ElQFJT9rWSL/N3V12AJkkphPL3KPOIPZm2X9XhUTmMUdx1byR2S4HHHHUL4/odhnO3Sx46kAblL2c4fnHitY7U38OvZMD4wITAJBgUrDgMCGgUABBQ3AV/s7mE39D7JTs17AVBFXqo73AQUqj/bp1aJjQHAvZ+cDMw2MJQNUT0CAwGGoA==</privateKeyStore>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>880</xloc>
      <yloc>16</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Daily Sales Output</name>
    <type>GoogleSpreadsheetOutput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <serviceEmail>spreadsheets@marcia-mello.iam.gserviceaccount.com</serviceEmail>
    <spreadsheetKey>17S5r8m700DAiTUKwXELXIjFqDhFGAIEw5zSccXXDBKY</spreadsheetKey>
    <worksheetId>okhov0b</worksheetId>
    <privateKeyStore>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</privateKeyStore>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>256</xloc>
      <yloc>176</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Daily Sales Sellers</name>
    <type>TableInput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>Linx</connection>
    <sql>SELECT
COALESCE(lmd.desc_motivo_desconto,'VAZIO') as cupom,
sf.sigla_filial + ' - ' + SUBSTRING(lv.vendedor_apelido, 1, CHARINDEX(' ', lv.vendedor_apelido, 1) - 1) as vendedor,
LTRIM(RTRIM(COALESCE(NULLIF(f.filial,'E-COMMERCE'),'CAMBUI'))) as filial,
CASE
	WHEN CONVERT(NVARCHAR(6), vp.data_venda, 112) = CONVERT(NVARCHAR(6), GETDATE()-1, 112) THEN 'MTD'
	WHEN CONVERT(NVARCHAR(6), vp.data_venda, 112) = CONVERT(NVARCHAR(6), DATEADD(m,-1,GETDATE()-1), 112) THEN 'LM'
	WHEN CONVERT(NVARCHAR(6), vp.data_venda, 112) = CONVERT(NVARCHAR(6), DATEADD(yy,-1,GETDATE()-1), 112) THEN 'LY'
END as periodo,
CASE WHEN CONVERT(NVARCHAR(6), vp.data_venda, 112) = CONVERT(NVARCHAR(6), GETDATE()-1, 112) THEN CONVERT(NVARCHAR,vp.data_venda,103) ELSE '' END as data_venda,
SUM(vp.qtde) as itens,
CAST(SUM(vp.qtde*(vp.preco_liquido + vp.desconto_item)) as INT) as preco_original_total,
CAST(SUM(vp.qtde*(v.valor_pago/v.valor_venda_bruta*vp.preco_liquido)) as INT) as receita_total,
CAST(SUM(c.preco1*vp.qtde) as INT) as custo_total
FROM loja_venda_produto vp
INNER JOIN loja_venda v on
	v.ticket = vp.ticket and
	vp.codigo_filial = v.codigo_filial and
	v.data_venda = vp.data_venda
INNER JOIN loja_vendedores lv on
	lv.codigo_filial = v.codigo_filial and
	lv.vendedor = v.vendedor
INNER JOIN filiais f on f.cod_filial = vp.codigo_filial
INNER JOIN (
	SELECT 'IGUATEMI CAMPINAS' as filial, 'IGUATEMI' as sigla_filial UNION
	SELECT 'MM DOM PEDRO' as filial, 'DOM PEDRO' as sigla_filial UNION
	SELECT 'PREMIUM OUTLET ITUPEVA' as filial, 'OUTLET' as sigla_filial UNION
	SELECT 'SANTA URSULA' as filial, 'RIBEIRÃO' as sigla_filial UNION
	SELECT 'JUNDIAI SHOPPING' as filial, 'JUNDIAÍ' as sigla_filial UNION
	SELECT 'SANTOS PRAIAMAR' as filial, 'SANTOS' as sigla_filial UNION
	SELECT 'PIRACICABA SHOPPING' as filial, 'PIRACICABA' as sigla_filial UNION
	SELECT 'CAMBUI' as filial, 'CAMBUÍ' as sigla_filial UNION
	SELECT 'E-COMMERCE' as filial, 'E-COMMERCE' as sigla_filial
) sf on sf.filial = COALESCE(NULLIF(LTRIM(RTRIM(f.filial)),'e-commerce'),'CAMBUI')
INNER JOIN produtos p on p.produto = vp.produto
INNER JOIN produtos_precos c on
	p.produto = c.produto and
	c.codigo_tab_preco = 02 -- 02 custo
LEFT JOIN loja_motivos_desconto lmd on lmd.codigo_desconto = v.codigo_desconto
WHERE
p.grupo_produto != 'GIFTCARD' and
vp.qtde > 0 and
vp.preco_liquido > 0 and
DAY(vp.data_venda) &lt;= DAY(GETDATE()-1) and CONVERT(NVARCHAR(6), vp.data_venda, 112) IN (
	CONVERT(NVARCHAR(6), GETDATE()-1, 112), -- Mes Atual
	CONVERT(NVARCHAR(6), DATEADD(m,-1,GETDATE()-1), 112), -- Mes Passado
	CONVERT(NVARCHAR(6), DATEADD(yy,-1,GETDATE()-1), 112) -- Ano Passado
)
GROUP BY
COALESCE(lmd.desc_motivo_desconto,'VAZIO'),
sf.sigla_filial + ' - ' + SUBSTRING(lv.vendedor_apelido, 1, CHARINDEX(' ', lv.vendedor_apelido, 1) - 1),
LTRIM(RTRIM(COALESCE(NULLIF(f.filial,'E-COMMERCE'),'CAMBUI'))),
CASE
	WHEN CONVERT(NVARCHAR(6), vp.data_venda, 112) = CONVERT(NVARCHAR(6), GETDATE()-1, 112) THEN 'MTD'
	WHEN CONVERT(NVARCHAR(6), vp.data_venda, 112) = CONVERT(NVARCHAR(6), DATEADD(m,-1,GETDATE()-1), 112) THEN 'LM'
	WHEN CONVERT(NVARCHAR(6), vp.data_venda, 112) = CONVERT(NVARCHAR(6), DATEADD(yy,-1,GETDATE()-1), 112) THEN 'LY'
END,
CASE WHEN CONVERT(NVARCHAR(6), vp.data_venda, 112) = CONVERT(NVARCHAR(6), GETDATE()-1, 112) THEN CONVERT(NVARCHAR,vp.data_venda,103) ELSE '' END


UNION

SELECT
'VAZIO' as cupom,
'' as vendedor,
'E-COMMERCE' as filial,
CASE
	WHEN CONVERT(NVARCHAR(6), f.emissao, 112) = CONVERT(NVARCHAR(6), GETDATE()-1, 112) THEN 'MTD'
	WHEN CONVERT(NVARCHAR(6), f.emissao, 112) = CONVERT(NVARCHAR(6), DATEADD(m,-1,GETDATE()-1), 112) THEN 'LM'
	WHEN CONVERT(NVARCHAR(6), f.emissao, 112) = CONVERT(NVARCHAR(6), DATEADD(yy,-1,GETDATE()-1), 112) THEN 'LY'
END as periodo,
CASE WHEN CONVERT(NVARCHAR(6), f.emissao, 112) = CONVERT(NVARCHAR(6), GETDATE()-1, 112) THEN CONVERT(NVARCHAR,f.emissao,103) ELSE '' END as data_venda,
SUM(fp.qtde) as itens,
CAST(SUM(fp.valor + fp.desconto_item) as INT) as preco_original_total,
CAST(SUM(f.valor_total/f.valor_sub_itens*fp.valor) as INT) as receita_total,
CAST(SUM(c.preco1*fp.qtde) as INT) as custo_total
FROM faturamento_prod fp
INNER JOIN faturamento f on
	f.nf_saida = fp.NF_SAIDA and
	fp.filial = f.filial
INNER JOIN produtos p on p.produto = fp.produto
INNER JOIN produtos_precos c on
	p.produto = c.produto and
	c.codigo_tab_preco = 02 -- 02 custo
WHERE
p.grupo_produto != 'GIFTCARD' and
fp.qtde > 0 and
f.valor_sub_itens > 0 and
fp.serie_nf IN (2,7) and
f.natureza_saida = '100.01' and
f.filial = 'e-commerce' and
DAY(f.emissao) &lt;= DAY(GETDATE()-1) and CONVERT(NVARCHAR(6), f.emissao, 112) IN (
	CONVERT(NVARCHAR(6), GETDATE()-1, 112), -- Mes Atual
	CONVERT(NVARCHAR(6), DATEADD(m,-1,GETDATE()-1), 112), -- Mes Passado
	CONVERT(NVARCHAR(6), DATEADD(yy,-1,GETDATE()-1), 112) -- Ano Passado
)
GROUP BY
CASE
	WHEN CONVERT(NVARCHAR(6), f.emissao, 112) = CONVERT(NVARCHAR(6), GETDATE()-1, 112) THEN 'MTD'
	WHEN CONVERT(NVARCHAR(6), f.emissao, 112) = CONVERT(NVARCHAR(6), DATEADD(m,-1,GETDATE()-1), 112) THEN 'LM'
	WHEN CONVERT(NVARCHAR(6), f.emissao, 112) = CONVERT(NVARCHAR(6), DATEADD(yy,-1,GETDATE()-1), 112) THEN 'LY'
END,
CASE WHEN CONVERT(NVARCHAR(6), f.emissao, 112) = CONVERT(NVARCHAR(6), GETDATE()-1, 112) THEN CONVERT(NVARCHAR,f.emissao,103) ELSE '' END</sql>
    <limit>0</limit>
    <lookup />
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>96</xloc>
      <yloc>256</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Daily Sales Sellers Output</name>
    <type>GoogleSpreadsheetOutput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <serviceEmail>spreadsheets@marcia-mello.iam.gserviceaccount.com</serviceEmail>
    <spreadsheetKey>17S5r8m700DAiTUKwXELXIjFqDhFGAIEw5zSccXXDBKY</spreadsheetKey>
    <worksheetId>of6w86y</worksheetId>
    <privateKeyStore>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</privateKeyStore>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>256</xloc>
      <yloc>256</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Daily Sales Sellers Output 2</name>
    <type>GoogleSpreadsheetOutput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <serviceEmail>spreadsheets@marcia-mello.iam.gserviceaccount.com</serviceEmail>
    <spreadsheetKey>17S5r8m700DAiTUKwXELXIjFqDhFGAIEw5zSccXXDBKY</spreadsheetKey>
    <worksheetId>ouzctw0</worksheetId>
    <privateKeyStore>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</privateKeyStore>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>576</xloc>
      <yloc>256</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Daily Sales Sellers WEEK</name>
    <type>TableInput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>Linx</connection>
    <sql>SELECT
COALESCE(lmd.desc_motivo_desconto,'VAZIO') as cupom,
sf.sigla_filial + ' - ' + SUBSTRING(lv.vendedor_apelido, 1, CHARINDEX(' ', lv.vendedor_apelido, 1) - 1) as vendedor,
LTRIM(RTRIM(COALESCE(NULLIF(f.filial,'E-COMMERCE'),'CAMBUI'))) as filial,
CASE
	WHEN CAST(vp.data_venda as DATE) BETWEEN CAST(GETDATE()-7 as DATE) AND CAST(GETDATE()-1 as DATE) THEN 'WEEK'
	WHEN CAST(vp.data_venda as DATE) BETWEEN CAST(GETDATE()-14 as DATE) AND CAST(GETDATE()-8 as DATE) THEN 'LW'
	WHEN CAST(vp.data_venda as DATE) BETWEEN DATEADD(week,-52,CAST(GETDATE()-7 as DATE)) AND DATEADD(week,-52,CAST(GETDATE()-1 as DATE)) THEN 'LYW'
END as periodo,
'' as data_venda,
SUM(vp.qtde) as itens,
CAST(SUM(vp.qtde*(vp.preco_liquido + vp.desconto_item)) as INT) as preco_original_total,
CAST(SUM(vp.qtde*(v.valor_pago/v.valor_venda_bruta*vp.preco_liquido)) as INT) as receita_total,
CAST(SUM(c.preco1*vp.qtde) as INT) as custo_total
FROM loja_venda_produto vp
INNER JOIN loja_venda v on
	v.ticket = vp.ticket and
	vp.codigo_filial = v.codigo_filial and
	v.data_venda = vp.data_venda
INNER JOIN loja_vendedores lv on
	lv.codigo_filial = v.codigo_filial and
	lv.vendedor = v.vendedor
INNER JOIN filiais f on f.cod_filial = vp.codigo_filial
INNER JOIN (
	SELECT 'IGUATEMI CAMPINAS' as filial, 'IGUATEMI' as sigla_filial UNION
	SELECT 'MM DOM PEDRO' as filial, 'DOM PEDRO' as sigla_filial UNION
	SELECT 'PREMIUM OUTLET ITUPEVA' as filial, 'OUTLET' as sigla_filial UNION
	SELECT 'SANTA URSULA' as filial, 'RIBEIRÃO' as sigla_filial UNION
	SELECT 'JUNDIAI SHOPPING' as filial, 'JUNDIAÍ' as sigla_filial UNION
	SELECT 'SANTOS PRAIAMAR' as filial, 'SANTOS' as sigla_filial UNION
	SELECT 'PIRACICABA SHOPPING' as filial, 'PIRACICABA' as sigla_filial UNION
	SELECT 'CAMBUI' as filial, 'CAMBUÍ' as sigla_filial UNION
	SELECT 'E-COMMERCE' as filial, 'E-COMMERCE' as sigla_filial
) sf on sf.filial = COALESCE(NULLIF(LTRIM(RTRIM(f.filial)),'e-commerce'),'CAMBUI')
INNER JOIN produtos p on p.produto = vp.produto
INNER JOIN produtos_precos c on
	p.produto = c.produto and
	c.codigo_tab_preco = 02 -- 02 custo
LEFT JOIN loja_motivos_desconto lmd on lmd.codigo_desconto = v.codigo_desconto
WHERE
p.grupo_produto != 'GIFTCARD' and
vp.qtde > 0 and
vp.preco_liquido > 0 and
(
	CAST(vp.data_venda as DATE) BETWEEN CAST(GETDATE()-7 as DATE) AND CAST(GETDATE()-1 as DATE) -- Semana Atual
	OR CAST(vp.data_venda as DATE) BETWEEN CAST(GETDATE()-14 as DATE) AND CAST(GETDATE()-8 as DATE) -- Semana Passada
	OR CAST(vp.data_venda as DATE) BETWEEN DATEADD(week,-52,CAST(GETDATE()-7 as DATE)) AND DATEADD(week,-52,CAST(GETDATE()-1 as DATE)) -- Semana Ano Passado
)
GROUP BY
COALESCE(lmd.desc_motivo_desconto,'VAZIO'),
sf.sigla_filial + ' - ' + SUBSTRING(lv.vendedor_apelido, 1, CHARINDEX(' ', lv.vendedor_apelido, 1) - 1),
LTRIM(RTRIM(COALESCE(NULLIF(f.filial,'E-COMMERCE'),'CAMBUI'))),
CASE
	WHEN CAST(vp.data_venda as DATE) BETWEEN CAST(GETDATE()-7 as DATE) AND CAST(GETDATE()-1 as DATE) THEN 'WEEK'
	WHEN CAST(vp.data_venda as DATE) BETWEEN CAST(GETDATE()-14 as DATE) AND CAST(GETDATE()-8 as DATE) THEN 'LW'
	WHEN CAST(vp.data_venda as DATE) BETWEEN DATEADD(week,-52,CAST(GETDATE()-7 as DATE)) AND DATEADD(week,-52,CAST(GETDATE()-1 as DATE)) THEN 'LYW'
END


UNION

SELECT
'VAZIO' as cupom,
'' as vendedor,
'E-COMMERCE' as filial,
CASE
	WHEN CAST(f.emissao as DATE) BETWEEN CAST(GETDATE()-7 as DATE) AND CAST(GETDATE()-1 as DATE) THEN 'WEEK'
	WHEN CAST(f.emissao as DATE) BETWEEN CAST(GETDATE()-14 as DATE) AND CAST(GETDATE()-8 as DATE) THEN 'LW'
	WHEN CAST(f.emissao as DATE) BETWEEN DATEADD(week,-52,CAST(GETDATE()-7 as DATE)) AND DATEADD(week,-52,CAST(GETDATE()-1 as DATE)) THEN 'LYW'
END as periodo,
'' as data_venda,
SUM(fp.qtde) as itens,
CAST(SUM(fp.valor + fp.desconto_item) as INT) as preco_original_total,
CAST(SUM(f.valor_total/f.valor_sub_itens*fp.valor) as INT) as receita_total,
CAST(SUM(c.preco1*fp.qtde) as INT) as custo_total
FROM faturamento_prod fp
INNER JOIN faturamento f on
	f.nf_saida = fp.NF_SAIDA and
	fp.filial = f.filial
INNER JOIN produtos p on p.produto = fp.produto
INNER JOIN produtos_precos c on
	p.produto = c.produto and
	c.codigo_tab_preco = 02 -- 02 custo
WHERE
p.grupo_produto != 'GIFTCARD' and
fp.qtde > 0 and
f.valor_sub_itens > 0 and
fp.serie_nf IN (2,7) and
f.natureza_saida = '100.01' and
f.filial = 'e-commerce' and
(
	CAST(f.emissao as DATE) BETWEEN CAST(GETDATE()-7 as DATE) AND CAST(GETDATE()-1 as DATE) -- Semana Atual
	OR CAST(f.emissao as DATE) BETWEEN CAST(GETDATE()-14 as DATE) AND CAST(GETDATE()-8 as DATE) -- Semana Passada
	OR CAST(f.emissao as DATE) BETWEEN DATEADD(week,-52,CAST(GETDATE()-7 as DATE)) AND DATEADD(week,-52,CAST(GETDATE()-1 as DATE)) -- Semana Ano Passado
)
GROUP BY
CASE
	WHEN CAST(f.emissao as DATE) BETWEEN CAST(GETDATE()-7 as DATE) AND CAST(GETDATE()-1 as DATE) THEN 'WEEK'
	WHEN CAST(f.emissao as DATE) BETWEEN CAST(GETDATE()-14 as DATE) AND CAST(GETDATE()-8 as DATE) THEN 'LW'
	WHEN CAST(f.emissao as DATE) BETWEEN DATEADD(week,-52,CAST(GETDATE()-7 as DATE)) AND DATEADD(week,-52,CAST(GETDATE()-1 as DATE)) THEN 'LYW'
END</sql>
    <limit>0</limit>
    <lookup />
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>416</xloc>
      <yloc>256</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Daily Sales Week</name>
    <type>TableInput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>Linx</connection>
    <sql>SELECT
p.colecao,
COALESCE(ccc.categoria,cct.categoria,ccs.categoria,cc.categoria,'Outros') as categoria,
LTRIM(RTRIM(COALESCE(NULLIF(f.filial,'E-COMMERCE'),'CAMBUI'))) as filial,
CASE
	WHEN CAST(vp.data_venda as DATE) BETWEEN CAST(GETDATE()-7 as DATE) AND CAST(GETDATE()-1 as DATE) THEN 'WEEK'
	WHEN CAST(vp.data_venda as DATE) BETWEEN CAST(GETDATE()-14 as DATE) AND CAST(GETDATE()-8 as DATE) THEN 'LW'
	WHEN CAST(vp.data_venda as DATE) BETWEEN DATEADD(week,-52,CAST(GETDATE()-7 as DATE)) AND DATEADD(week,-52,CAST(GETDATE()-1 as DATE)) THEN 'LYW'
END as periodo,
'' as data_venda,
SUM(vp.qtde) as itens,
CAST(SUM(vp.qtde*(vp.preco_liquido + vp.desconto_item)) as INT) as preco_original_total,
CAST(SUM(vp.qtde*(v.valor_pago/v.valor_venda_bruta*vp.preco_liquido)) as INT) as receita_total,
CAST(SUM(c.preco1*vp.qtde) as INT) as custo_total
FROM loja_venda_produto vp
INNER JOIN loja_venda v on
	v.ticket = vp.ticket and
	vp.codigo_filial = v.codigo_filial and
	v.data_venda = vp.data_venda
INNER JOIN filiais f on f.cod_filial = vp.codigo_filial
INNER JOIN produtos p on p.produto = vp.produto
INNER JOIN produtos_precos c on
	p.produto = c.produto and
	c.codigo_tab_preco = 02 -- 02 custo
LEFT JOIN bi_categorizacao_categoria ccc on
	ccc.grupo_produto = p.grupo_produto and
	ccc.cod_categoria = p.cod_categoria and
	ccc.subgrupo_produto is null and
	ccc.tipo_produto is null
LEFT JOIN bi_categorizacao_categoria cct on
	cct.grupo_produto = p.grupo_produto and
	cct.tipo_produto = p.tipo_produto and
	cct.subgrupo_produto is null and
	cct.cod_categoria is null
LEFT JOIN bi_categorizacao_categoria ccs on
	ccs.grupo_produto = p.grupo_produto and
	ccs.subgrupo_produto = p.subgrupo_produto and
	ccs.tipo_produto is null and
	ccs.cod_categoria is null
LEFT JOIN bi_categorizacao_categoria cc on
	cc.grupo_produto = p.grupo_produto and
	cc.subgrupo_produto is null and
	cc.tipo_produto is null and
	cc.cod_categoria is null
WHERE
p.grupo_produto != 'GIFTCARD' and
vp.qtde > 0 and
vp.preco_liquido > 0 and
(
	CAST(vp.data_venda as DATE) BETWEEN CAST(GETDATE()-7 as DATE) AND CAST(GETDATE()-1 as DATE) -- Semana Atual
	OR CAST(vp.data_venda as DATE) BETWEEN CAST(GETDATE()-14 as DATE) AND CAST(GETDATE()-8 as DATE) -- Semana Passada
	OR CAST(vp.data_venda as DATE) BETWEEN DATEADD(week,-52,CAST(GETDATE()-7 as DATE)) AND DATEADD(week,-52,CAST(GETDATE()-1 as DATE)) -- Semana Ano Passado
)
GROUP BY
p.colecao,
COALESCE(ccc.categoria,cct.categoria,ccs.categoria,cc.categoria,'Outros'),
LTRIM(RTRIM(COALESCE(NULLIF(f.filial,'E-COMMERCE'),'CAMBUI'))),
CASE
	WHEN CAST(vp.data_venda as DATE) BETWEEN CAST(GETDATE()-7 as DATE) AND CAST(GETDATE()-1 as DATE) THEN 'WEEK'
	WHEN CAST(vp.data_venda as DATE) BETWEEN CAST(GETDATE()-14 as DATE) AND CAST(GETDATE()-8 as DATE) THEN 'LW'
	WHEN CAST(vp.data_venda as DATE) BETWEEN DATEADD(week,-52,CAST(GETDATE()-7 as DATE)) AND DATEADD(week,-52,CAST(GETDATE()-1 as DATE)) THEN 'LYW'
END


UNION

SELECT
p.colecao,
COALESCE(ccc.categoria,cct.categoria,ccs.categoria,cc.categoria,'Outros') as categoria,
'E-COMMERCE' as filial,
CASE
	WHEN CAST(f.emissao as DATE) BETWEEN CAST(GETDATE()-7 as DATE) AND CAST(GETDATE()-1 as DATE) THEN 'WEEK'
	WHEN CAST(f.emissao as DATE) BETWEEN CAST(GETDATE()-14 as DATE) AND CAST(GETDATE()-8 as DATE) THEN 'LW'
	WHEN CAST(f.emissao as DATE) BETWEEN DATEADD(week,-52,CAST(GETDATE()-7 as DATE)) AND DATEADD(week,-52,CAST(GETDATE()-1 as DATE)) THEN 'LYW'
END as periodo,
'' as data_venda,
SUM(fp.qtde) as itens,
CAST(SUM(fp.valor + fp.desconto_item) as INT) as preco_original_total,
CAST(SUM(f.valor_total/f.valor_sub_itens*fp.valor) as INT) as receita_total,
CAST(SUM(c.preco1*fp.qtde) as INT) as custo_total
FROM faturamento_prod fp
INNER JOIN faturamento f on
	f.nf_saida = fp.NF_SAIDA and
	fp.filial = f.filial
INNER JOIN produtos p on p.produto = fp.produto
INNER JOIN produtos_precos c on
	p.produto = c.produto and
	c.codigo_tab_preco = 02 -- 02 custo
LEFT JOIN bi_categorizacao_categoria ccc on
	ccc.grupo_produto = p.grupo_produto and
	ccc.cod_categoria = p.cod_categoria and
	ccc.subgrupo_produto is null and
	ccc.tipo_produto is null
LEFT JOIN bi_categorizacao_categoria cct on
	cct.grupo_produto = p.grupo_produto and
	cct.tipo_produto = p.tipo_produto and
	cct.subgrupo_produto is null and
	cct.cod_categoria is null
LEFT JOIN bi_categorizacao_categoria ccs on
	ccs.grupo_produto = p.grupo_produto and
	ccs.subgrupo_produto = p.subgrupo_produto and
	ccs.tipo_produto is null and
	ccs.cod_categoria is null
LEFT JOIN bi_categorizacao_categoria cc on
	cc.grupo_produto = p.grupo_produto and
	cc.subgrupo_produto is null and
	cc.tipo_produto is null and
	cc.cod_categoria is null
WHERE
p.grupo_produto != 'GIFTCARD' and
fp.qtde > 0 and
f.valor_sub_itens > 0 and
fp.serie_nf IN (2,7) and
f.natureza_saida = '100.01' and
f.filial = 'e-commerce' and
(
	CAST(f.emissao as DATE) BETWEEN CAST(GETDATE()-7 as DATE) AND CAST(GETDATE()-1 as DATE) -- Semana Atual
	OR CAST(f.emissao as DATE) BETWEEN CAST(GETDATE()-14 as DATE) AND CAST(GETDATE()-8 as DATE) -- Semana Passada
	OR CAST(f.emissao as DATE) BETWEEN DATEADD(week,-52,CAST(GETDATE()-7 as DATE)) AND DATEADD(week,-52,CAST(GETDATE()-1 as DATE)) -- Semana Ano Passado
)
GROUP BY
p.colecao,
COALESCE(ccc.categoria,cct.categoria,ccs.categoria,cc.categoria,'Outros'),
CASE
	WHEN CAST(f.emissao as DATE) BETWEEN CAST(GETDATE()-7 as DATE) AND CAST(GETDATE()-1 as DATE) THEN 'WEEK'
	WHEN CAST(f.emissao as DATE) BETWEEN CAST(GETDATE()-14 as DATE) AND CAST(GETDATE()-8 as DATE) THEN 'LW'
	WHEN CAST(f.emissao as DATE) BETWEEN DATEADD(week,-52,CAST(GETDATE()-7 as DATE)) AND DATEADD(week,-52,CAST(GETDATE()-1 as DATE)) THEN 'LYW'
END</sql>
    <limit>0</limit>
    <lookup />
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>416</xloc>
      <yloc>176</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Daily Sales Week Output</name>
    <type>GoogleSpreadsheetOutput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <serviceEmail>spreadsheets@marcia-mello.iam.gserviceaccount.com</serviceEmail>
    <spreadsheetKey>17S5r8m700DAiTUKwXELXIjFqDhFGAIEw5zSccXXDBKY</spreadsheetKey>
    <worksheetId>o973wjv</worksheetId>
    <privateKeyStore>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</privateKeyStore>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>576</xloc>
      <yloc>176</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Receivings</name>
    <type>TableInput</type>
    <description />
    <distribute>N</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>Linx</connection>
    <sql>SELECT
p.colecao,
COALESCE(ccc.categoria,cct.categoria,ccs.categoria,cc.categoria,'Outros') as categoria,
COALESCE(gf.filial,LTRIM(RTRIM(c.filial_a_entregar))) as filial,
SUM(cp.qtde_entregar) as quantidade_a_receber,
REPLACE(SUM(cp.valor_entregar),'.',',') as custo_a_receber,
COUNT(DISTINCT cp.produto + cp.cor_produto) as produtos_a_receber
FROM compras_produto cp
INNER JOIN compras c on cp.pedido = c.pedido
INNER JOIN produtos p on cp.produto = p.produto
LEFT JOIN bi_categorizacao_categoria ccc on
	ccc.grupo_produto = p.grupo_produto and
	ccc.cod_categoria = p.cod_categoria and
	ccc.subgrupo_produto is null and
	ccc.tipo_produto is null
LEFT JOIN bi_categorizacao_categoria cct on
	cct.grupo_produto = p.grupo_produto and
	cct.tipo_produto = p.tipo_produto and
	cct.subgrupo_produto is null and
	cct.cod_categoria is null
LEFT JOIN bi_categorizacao_categoria ccs on
	ccs.grupo_produto = p.grupo_produto and
	ccs.subgrupo_produto = p.subgrupo_produto and
	ccs.tipo_produto is null and
	ccs.cod_categoria is null
LEFT JOIN bi_categorizacao_categoria cc on
	cc.grupo_produto = p.grupo_produto and
	cc.subgrupo_produto is null and
	cc.tipo_produto is null and
	cc.cod_categoria is null
LEFT JOIN (
	SELECT 'E-COMMERCE' as filial, 'E-COMMERCE' as grupo_filial UNION
	SELECT 'CAMBUI' as filial, 'E-COMMERCE' as grupo_filial
) gf on gf.grupo_filial = c.filial_a_entregar
WHERE
p.grupo_produto != 'GIFTCARD' and
YEAR(cp.entrega)*100 + MONTH(cp.entrega) = YEAR(GETDATE()-1)*100 + MONTH(GETDATE()-1)
and cp.qtde_entregar > 0
and cp.qtde_entregue = 0
GROUP BY
COALESCE(gf.filial,LTRIM(RTRIM(c.filial_a_entregar))),
p.colecao,
COALESCE(ccc.categoria,cct.categoria,ccs.categoria,cc.categoria,'Outros')</sql>
    <limit>0</limit>
    <lookup />
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>416</xloc>
      <yloc>96</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Receivings Output</name>
    <type>GoogleSpreadsheetOutput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <serviceEmail>spreadsheets@marcia-mello.iam.gserviceaccount.com</serviceEmail>
    <spreadsheetKey>17S5r8m700DAiTUKwXELXIjFqDhFGAIEw5zSccXXDBKY</spreadsheetKey>
    <worksheetId>oo19bh8</worksheetId>
    <privateKeyStore>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</privateKeyStore>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>576</xloc>
      <yloc>96</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Receivings Output WO Store</name>
    <type>GoogleSpreadsheetOutput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <serviceEmail>spreadsheets@marcia-mello.iam.gserviceaccount.com</serviceEmail>
    <spreadsheetKey>17S5r8m700DAiTUKwXELXIjFqDhFGAIEw5zSccXXDBKY</spreadsheetKey>
    <worksheetId>o48h762</worksheetId>
    <privateKeyStore>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</privateKeyStore>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>576</xloc>
      <yloc>16</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Receivings Without Store</name>
    <type>TableInput</type>
    <description />
    <distribute>N</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>Linx</connection>
    <sql>SELECT
p.colecao,
COALESCE(ccc.categoria,cct.categoria,ccs.categoria,cc.categoria,'Outros') as categoria,
'' as aux1,
'' as aux2,
'' as aux3,
COUNT(DISTINCT cp.produto + cp.cor_produto) as produtos_a_receber
FROM compras_produto cp
INNER JOIN compras c on cp.pedido = c.pedido
INNER JOIN produtos p on cp.produto = p.produto
LEFT JOIN bi_categorizacao_categoria ccc on
	ccc.grupo_produto = p.grupo_produto and
	ccc.cod_categoria = p.cod_categoria and
	ccc.subgrupo_produto is null and
	ccc.tipo_produto is null
LEFT JOIN bi_categorizacao_categoria cct on
	cct.grupo_produto = p.grupo_produto and
	cct.tipo_produto = p.tipo_produto and
	cct.subgrupo_produto is null and
	cct.cod_categoria is null
LEFT JOIN bi_categorizacao_categoria ccs on
	ccs.grupo_produto = p.grupo_produto and
	ccs.subgrupo_produto = p.subgrupo_produto and
	ccs.tipo_produto is null and
	ccs.cod_categoria is null
LEFT JOIN bi_categorizacao_categoria cc on
	cc.grupo_produto = p.grupo_produto and
	cc.subgrupo_produto is null and
	cc.tipo_produto is null and
	cc.cod_categoria is null
WHERE
p.grupo_produto != 'GIFTCARD' and
YEAR(cp.entrega)*100 + MONTH(cp.entrega) = YEAR(GETDATE()-1)*100 + MONTH(GETDATE()-1)
and cp.qtde_entregar > 0
and cp.qtde_entregue = 0
GROUP BY
p.colecao,
COALESCE(ccc.categoria,cct.categoria,ccs.categoria,cc.categoria,'Outros')</sql>
    <limit>0</limit>
    <lookup />
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>416</xloc>
      <yloc>16</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Stock</name>
    <type>TableInput</type>
    <description />
    <distribute>N</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>Linx</connection>
    <sql>SELECT
p.colecao,
COALESCE(ccc.categoria,cct.categoria,ccs.categoria,cc.categoria,'Outros') as categoria,
COALESCE(gf.filial,LTRIM(RTRIM(e.filial))) as filial,
SUM(CASE WHEN COALESCE(gf.filial,LTRIM(RTRIM(e.filial))) != 'E-COMMERCE' OR vpi.produto IS NOT NULL THEN e.estoque_disponivel END) as quantidade_estoque,
REPLACE(SUM(CASE WHEN COALESCE(gf.filial,LTRIM(RTRIM(e.filial))) != 'E-COMMERCE' OR vpi.produto IS NOT NULL THEN e.estoque_disponivel * c.preco1 END),'.',',') as custo_estoque,
COUNT(DISTINCT CASE WHEN COALESCE(gf.filial,LTRIM(RTRIM(e.filial))) != 'E-COMMERCE' OR vpi.produto IS NOT NULL THEN e.produto + e.cor_produto END) as produtos
FROM w_estoque_produtos_transito e
INNER JOIN produtos p on e.produto = p.produto
INNER JOIN produtos_precos c on
	e.produto = c.produto and
	c.codigo_tab_preco = 02 -- 02 custo
LEFT JOIN bi_categorizacao_categoria ccc on
	ccc.grupo_produto = p.grupo_produto and
	ccc.cod_categoria = p.cod_categoria and
	ccc.subgrupo_produto is null and
	ccc.tipo_produto is null
LEFT JOIN bi_categorizacao_categoria cct on
	cct.grupo_produto = p.grupo_produto and
	cct.tipo_produto = p.tipo_produto and
	cct.subgrupo_produto is null and
	cct.cod_categoria is null
LEFT JOIN bi_categorizacao_categoria ccs on
	ccs.grupo_produto = p.grupo_produto and
	ccs.subgrupo_produto = p.subgrupo_produto and
	ccs.tipo_produto is null and
	ccs.cod_categoria is null
LEFT JOIN bi_categorizacao_categoria cc on
	cc.grupo_produto = p.grupo_produto and
	cc.subgrupo_produto is null and
	cc.tipo_produto is null and
	cc.cod_categoria is null
LEFT JOIN (
	SELECT 'E-COMMERCE' as filial, 'E-COMMERCE' as grupo_filial UNION
	SELECT 'CAMBUI' as filial, 'E-COMMERCE' as grupo_filial
) gf on gf.grupo_filial = e.filial
LEFT JOIN bi_vtex_product_images vpi on
	vpi.produto = e.produto and
	vpi.cor_produto = e.cor_produto and
	vpi.numero = 1 and
	gf.filial = 'E-COMMERCE'
WHERE
p.grupo_produto != 'GIFTCARD' and
c.codigo_tab_preco = 02 and
e.estoque_disponivel > 0 and
e.filial in ('iguatemi campinas','santa ursula','mm dom pedro','premium outlet itupeva','santos praiamar','piracicaba shopping','jundiai shopping','e-commerce')
GROUP BY
p.colecao,
COALESCE(ccc.categoria,cct.categoria,ccs.categoria,cc.categoria,'Outros'),
COALESCE(gf.filial,LTRIM(RTRIM(e.filial)))</sql>
    <limit>0</limit>
    <lookup />
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>96</xloc>
      <yloc>96</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Stock Output</name>
    <type>GoogleSpreadsheetOutput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <serviceEmail>spreadsheets@marcia-mello.iam.gserviceaccount.com</serviceEmail>
    <spreadsheetKey>17S5r8m700DAiTUKwXELXIjFqDhFGAIEw5zSccXXDBKY</spreadsheetKey>
    <worksheetId>o3tk3sc</worksheetId>
    <privateKeyStore>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</privateKeyStore>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>256</xloc>
      <yloc>96</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Stock Output WO Store</name>
    <type>GoogleSpreadsheetOutput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <serviceEmail>spreadsheets@marcia-mello.iam.gserviceaccount.com</serviceEmail>
    <spreadsheetKey>17S5r8m700DAiTUKwXELXIjFqDhFGAIEw5zSccXXDBKY</spreadsheetKey>
    <worksheetId>obc5g81</worksheetId>
    <privateKeyStore>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</privateKeyStore>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>256</xloc>
      <yloc>16</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Stock Without Store</name>
    <type>TableInput</type>
    <description />
    <distribute>N</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>Linx</connection>
    <sql>SELECT
p.colecao,
COALESCE(ccc.categoria,cct.categoria,ccs.categoria,cc.categoria,'Outros') as categoria,
'' as aux1,
'' as aux2,
'' as aux3,
COUNT(DISTINCT e.produto + e.cor_produto) as produtos
FROM w_estoque_produtos_transito e
INNER JOIN produtos p on e.produto = p.produto
INNER JOIN produtos_precos c on
	e.produto = c.produto and
	c.codigo_tab_preco = 02 -- 02 custo
LEFT JOIN bi_categorizacao_categoria ccc on
	ccc.grupo_produto = p.grupo_produto and
	ccc.cod_categoria = p.cod_categoria and
	ccc.subgrupo_produto is null and
	ccc.tipo_produto is null
LEFT JOIN bi_categorizacao_categoria cct on
	cct.grupo_produto = p.grupo_produto and
	cct.tipo_produto = p.tipo_produto and
	cct.subgrupo_produto is null and
	cct.cod_categoria is null
LEFT JOIN bi_categorizacao_categoria ccs on
	ccs.grupo_produto = p.grupo_produto and
	ccs.subgrupo_produto = p.subgrupo_produto and
	ccs.tipo_produto is null and
	ccs.cod_categoria is null
LEFT JOIN bi_categorizacao_categoria cc on
	cc.grupo_produto = p.grupo_produto and
	cc.subgrupo_produto is null and
	cc.tipo_produto is null and
	cc.cod_categoria is null
WHERE
p.grupo_produto != 'GIFTCARD' and
c.codigo_tab_preco = 02 and
e.estoque_disponivel > 0 and
e.filial in ('iguatemi campinas','santa ursula','mm dom pedro','premium outlet itupeva','santos praiamar','piracicaba shopping','jundiai shopping','e-commerce')
GROUP BY
p.colecao,
COALESCE(ccc.categoria,cct.categoria,ccs.categoria,cc.categoria,'Outros')</sql>
    <limit>0</limit>
    <lookup />
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>96</xloc>
      <yloc>16</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step_error_handling>
  </step_error_handling>
  <slave-step-copy-partition-distribution>
  </slave-step-copy-partition-distribution>
  <slave_transformation>N</slave_transformation>
</transformation>
